<!DOCTYPE html>
<html>
<head>
    <title>Sticker-Tausch</title>
</head>
<body>
    <h1>Sticker-Tausch</h1>

    <img src="https://cdn-az.allevents.in/events5/banners/c9bfe45c49f187676123d5756265ce4f0d1dc77456b0f0ec68dca517380c1b9e-rimg-w960-h501-gmir.jpg?v=1698342865" alt="Sticker-Tausch-Logo" width="200" height="100">

    <br><br>Eingabe zurücksetzen<br><button onclick="resetFields()">clear</button>
    <br><br>

    <!-- Füge die Parameter für die Eingabefelder hinzu -->
    <script>
        // Funktion zum Extrahieren von Parametern aus der URL
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // Funktion zum Setzen der Eingabefeldwerte basierend auf den Parametern
        function setFieldValues() {
            document.getElementById('meSearch').value = getParameterByName('meSearch') || '';
            document.getElementById('partnerSearch').value = getParameterByName('partnerSearch') || '';
            document.getElementById('myDuplicates').value = getParameterByName('myDuplicates') || '';
            document.getElementById('partnerDuplicates').value = getParameterByName('partnerDuplicates') || '';
            calculateMatches();
        }

        // Führe die Funktion zum Setzen der Werte aus, wenn die Seite geladen wird
        window.onload = setFieldValues;

        // Funktion zum Kopieren des Links in die Zwischenablage
        function copyLink() {
            const linkInput = document.getElementById('linkInput');
            linkInput.select();
            document.execCommand('copy');
            alert('Link wurde in die Zwischenablage kopiert!');
        }
    </script>

    <div style="display: flex; flex-direction: row;">
        <div style="flex: 1;">
            <h2>Ich suche</h2>
            <input type="text" id="meSearch" placeholder="Gesuchte Sticker (Komma getrennt)">
        </div>

        <div style="flex: 1;">
            <h2>Mein Tauschpartner sucht</h2>
            <input type="text" id="partnerSearch" placeholder="Gesuchte Sticker (Komma getrennt)">
        </div>
    </div>

    <div style="display: flex; flex-direction: row;">
        <div style="flex: 1;">
            <h2>Ich habe doppelt</h2>
            <input type="text" id="myDuplicates" placeholder="Meine doppelten Sticker (Komma getrennt)">
        </div>

        <div style="flex: 1;">
            <h2>Mein Tauschpartner hat doppelt</h2>
            <input type="text" id="partnerDuplicates" placeholder="Doppelte Sticker deines Tauschpartners (Komma getrennt)">
        </div>
    </div>

    <div>
        <h2>Ergebnis</h2>
        <div id="result"></div>
    </div>

    <div>
        <h2>Übrig gebliebene Sticker</h2>
        <div id="remaining"></div>
    </div>

    <div>
        <h2>Noch gesuchte Sticker</h2>
        <div id="stillSearching"></div>
    </div>

    <!-- Anzeige des Links und Kopier-Button -->
    <div>
        <h2>Link zum Teilen</h2>
        <input type="text" id="linkInput" style="width: 80%;" readonly>
        <button onclick="copyLink()">Copy Link</button>
    </div>

    <script>
        function calculateMatches() {
			const meSearch = parseInput(document.getElementById('meSearch').value);
            const partnerSearch = parseInput(document.getElementById('partnerSearch').value);
            const myDuplicates = parseInput(document.getElementById('myDuplicates').value);
            const partnerDuplicates = parseInput(document.getElementById('partnerDuplicates').value);

            const commonSearch = meSearch.filter(value => partnerDuplicates.includes(value));
            const commonDuplicates = partnerSearch.filter(value => myDuplicates.includes(value));

            const resultSearch = groupAndDisplay("Gesuchte Sticker, die dein Tauschpartner doppelt hat", commonSearch);
            const resultDuplicates = groupAndDisplay("Gesuchte Sticker deines Tauschpartners, die du doppelt hast", commonDuplicates);

            const remainingStickers = myDuplicates.slice();

            for (const sticker of commonDuplicates) {
                const index = remainingStickers.indexOf(sticker);

                if (index !== -1) {
                    remainingStickers.splice(index, 1);
                }
            }

            const remainingResult = groupAndDisplay("Übrig gebliebene Sticker nach dem Tausch", remainingStickers);

            const stillSearchingStickers = meSearch.filter(value => !commonSearch.includes(value));
            const stillSearchingResult = groupAndDisplay("Noch gesuchte Sticker", stillSearchingStickers);

            document.getElementById('result').innerHTML = resultSearch + '<br><br>' + resultDuplicates;
            document.getElementById('remaining').innerHTML = remainingResult;
            document.getElementById('stillSearching').innerHTML = stillSearchingResult;
            // Aktualisiere den Link beim Berechnen der Übereinstimmungen
            updateShareLink();
        }

        function updateShareLink() {
            const meSearchValue = encodeURIComponent(document.getElementById('meSearch').value);
            const partnerSearchValue = encodeURIComponent(document.getElementById('partnerSearch').value);
            const myDuplicatesValue = encodeURIComponent(document.getElementById('myDuplicates').value);
            const partnerDuplicatesValue = encodeURIComponent(document.getElementById('partnerDuplicates').value);

            const shareLink = `${window.location.origin}${window.location.pathname}?meSearch=${meSearchValue}&partnerSearch=${partnerSearchValue}&myDuplicates=${myDuplicatesValue}&partnerDuplicates=${partnerDuplicatesValue}`;
            document.getElementById('linkInput').value = shareLink;
        }

        // Füge die Event Listener für die Input-Felder hinzu
        document.getElementById('meSearch').addEventListener('input', calculateMatches);
        document.getElementById('partnerSearch').addEventListener('input', calculateMatches);
        document.getElementById('myDuplicates').addEventListener('input', calculateMatches);
        document.getElementById('partnerDuplicates').addEventListener('input', calculateMatches);

        // Aktualisiere den Link beim Laden der Seite
        window.onload = function () {
            setFieldValues();
            updateShareLink();
        };
    </script>
</body>
</html>
