<!DOCTYPE html>
<html>
<head>
    <title>Sticker-Tausch</title>
</head>
<body>
    <h1>Sticker-Tausch</h1>

    <img src="https://cdn-az.allevents.in/events5/banners/c9bfe45c49f187676123d5756265ce4f0d1dc77456b0f0ec68dca517380c1b9e-rimg-w960-h501-gmir.jpg?v=1698342865" alt="Sticker-Tausch-Logo" width="200" height="100">

    <br><br>Eingabe zurücksetzen<br><button onclick="resetFields()">clear</button>
    <br><br>
    <div style="display: flex; flex-direction: row;">
        <div style="flex: 1;">
            <h2>Ich suche</h2>
            <input type="text" id="meSearch" placeholder="Gesuchte Sticker (Komma getrennt)">
        </div>

        <div style="flex: 1;">
            <h2>Mein Tauschpartner sucht</h2>
            <input type="text" id="partnerSearch" placeholder="Gesuchte Sticker (Komma getrennt)">
        </div>
    </div>

    <div style="display: flex; flex-direction: row;">
        <div style="flex: 1;">
            <h2>Ich habe doppelt</h2>
            <input type="text" id="myDuplicates" placeholder="Meine doppelten Sticker (Komma getrennt)">
        </div>

        <div style="flex: 1;">
            <h2>Mein Tauschpartner hat doppelt</h2>
            <input type="text" id="partnerDuplicates" placeholder="Doppelte Sticker deines Tauschpartners (Komma getrennt)">
        </div>
    </div>

    <div>
        <h2>Ergebnis</h2>
        <div id="result"></div>
    </div>

    <div>
        <h2>Übrig gebliebene Sticker</h2>
        <div id="remaining"></div>
    </div>

    <div>
        <h2>Noch gesuchte Sticker</h2>
        <div id="stillSearching"></div>
    </div>

    <div>
        <h2>Teile diesen Link:</h2>
        <div id="shareLinkContainer">
            <input type="text" id="shareLinkInput" readonly>
            <button onclick="copyShareLink()">Kopieren</button>
        </div>
    </div>

    <script>
        function calculateMatches() {
            const meSearch = parseInput(document.getElementById('meSearch').value);
            const partnerSearch = parseInput(document.getElementById('partnerSearch').value);
            const myDuplicates = parseInput(document.getElementById('myDuplicates').value);
            const partnerDuplicates = parseInput(document.getElementById('partnerDuplicates').value);

            const commonSearch = meSearch.filter(value => partnerDuplicates.includes(value));
            const commonDuplicates = partnerSearch.filter(value => myDuplicates.includes(value));

            const resultSearch = groupAndDisplay("Gesuchte Sticker, die dein Tauschpartner doppelt hat", commonSearch);
            const resultDuplicates = groupAndDisplay("Gesuchte Sticker deines Tauschpartners, die du doppelt hast", commonDuplicates);

            const remainingStickers = myDuplicates.slice();

            for (const sticker of commonDuplicates) {
                const index = remainingStickers.indexOf(sticker);

                if (index !== -1) {
                    remainingStickers.splice(index, 1);
                }
            }

            const remainingResult = groupAndDisplay("Übrig gebliebene Sticker nach dem Tausch", remainingStickers);

            const stillSearchingStickers = meSearch.filter(value => !commonSearch.includes(value));
            const stillSearchingResult = groupAndDisplay("Noch gesuchte Sticker", stillSearchingStickers);

            document.getElementById('result').innerHTML = resultSearch + '<br><br>' + resultDuplicates;
            document.getElementById('remaining').innerHTML = remainingResult;
            document.getElementById('stillSearching').innerHTML = stillSearchingResult;

            // Nach der Berechnung auch den Link aktualisieren
            updateShareLink();
        }

        function resetFields() {
            document.getElementById('meSearch').value = '';
            document.getElementById('partnerSearch').value = '';
            document.getElementById('myDuplicates').value = '';
            document.getElementById('partnerDuplicates').value = '';
            calculateMatches();
        }

        function parseInput(input) {
            return input.split(/,|, | /).map(item => item.trim()).filter(item => item !== "");
        }

        function groupAndDisplay(description, numbers) {
            const groupedNumbers = {};
        
            for (const number of numbers) {
                const block = Math.floor(number / 100);
                if (!groupedNumbers[block]) {
                    groupedNumbers[block] = [];
                }
                groupedNumbers[block].push(number);
            }
        
            const result = [];
            let totalStickerCount = 0;
        
            for (const key in groupedNumbers) {
                const stickerList = groupedNumbers[key].join(', ');
                result.push(stickerList);
                totalStickerCount += groupedNumbers[key].length;
            }
        
            const descriptionString = `${description} (${totalStickerCount} Sticker):`;
            result.unshift(descriptionString);
        
            if (totalStickerCount > 0) {
                return result.join('<br>');
            } else {
                return `${description} (0 Sticker):`;
            }
        }

        // Hier füge die folgenden Funktionen für die Link-Funktionalität hinzu

        function updateShareLink() {
            const sessionID = getParameterByName('session');
            const shareLinkInput = document.getElementById('shareLinkInput');
            shareLinkInput.value = window.location.origin + window.location.pathname + `?session=${sessionID || generateSessionID()}`;
        }

        function copyShareLink() {
            const shareLinkInput = document.getElementById('shareLinkInput');
            shareLinkInput.select();
            document.execCommand('copy');
        }

        // Hier geht der Rest deines Codes weiter

        document.getElementById('meSearch').addEventListener('input', calculateMatches);
        document.getElementById('partnerSearch').addEventListener('input', calculateMatches);
        document.getElementById('myDuplicates').addEventListener('input', calculateMatches);
        document.getElementById('partnerDuplicates').addEventListener('input', calculateMatches);

        // Initialisierung beim Laden der Seite
        window.addEventListener('load', () => {
            calculateMatches();
            updateShareLink();
        });

    </script>
</body>
</html>
